{% extends 'base.html' %}
{% block title %}Let's Quiz | Eredm√©ny{% endblock title %}
{% block content %}

<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-3">
    <div class="card-body p-4">

      <!-- K√©rd√©s -->
      <h3 class="text-primary mb-4">
        {{ attempted_question.question.html|safe }}
      </h3>

      <!-- V√°laszaid -->
      <div class="mb-3">
        <h5 class="text-muted">A te v√°laszod:</h5>
        {% if attempted_question.question.matching_pairs.all %}
          <ul class="list-unstyled">
            {% for p in attempted_question.question.matching_pairs.all %}
              {% for m in attempted_question.attempted_matches.all %}
                {% if m.left_pair.id == p.id %}
                  {% if m.chosen_right_pair and m.chosen_right_pair.id == p.id %}
                    <li class="alert alert-success mb-2">‚úÖ {{ p.left_text }} ‚áî {{ p.right_text }}</li>
                  {% elif m.chosen_right_pair %}
                    <li class="alert alert-danger mb-2">
                      ‚ùå {{ p.left_text }} ‚áî {{ m.chosen_right_pair.right_text }}
                      <small class="text-muted">(helyes: {{ p.right_text }})</small>
                    </li>
                  {% else %}
                    <li class="alert alert-warning mb-2">
                      ‚ö†Ô∏è {{ p.left_text }} ‚áî <em>nincs p√°ros√≠t√°s</em>
                      <small class="text-muted">(helyes: {{ p.right_text }})</small>
                    </li>
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endfor %}
          </ul>
        {% elif attempted_question.question.correct_text_answer %}
          {% if attempted_question.text_answer %}
            <div class="alert alert-secondary py-2 mb-2">
              {{ attempted_question.text_answer }}
            </div>
          {% else %}
            <p class="text-warning">Nem adt√°l meg v√°laszt.</p>
          {% endif %}
        {% elif attempted_question.selected_choices.all %}
          {% for choice in attempted_question.selected_choices.all %}
            <div class="alert alert-secondary py-2 mb-2">
              {{ choice.html|safe }}
            </div>
          {% endfor %}
        {% else %}
          <p class="text-warning">Nem v√°lasztott√°l semmit.</p>
        {% endif %}
      </div>

      <!-- Helyes v√°laszok -->
      <div class="mb-4">
        <h5 class="text-muted">Helyes v√°lasz(ok):</h5>
        
        {% if attempted_question.question.matching_pairs.all %}
          <ul class="list-unstyled">
            {% for p in attempted_question.question.matching_pairs.all %}
              <li class="alert alert-info mb-2">
                {{ p.left_text }} ‚áî {{ p.right_text }}
              </li>
            {% endfor %}
          </ul>

        {% elif attempted_question.question.correct_text_answer %}
          <div class="alert alert-info py-2 mb-2">
            üí° {{ attempted_question.question.correct_text_answer }}
          </div>
        {% else %}
          {% for choice in attempted_question.question.choices.all %}
            {% if choice in attempted_question.selected_choices.all %}
              {% if choice.is_correct %}
                <div class="alert alert-success py-2 mb-2">
                  ‚úÖ {{ choice.html|safe }} (helyes v√°laszt√°s)
                </div>
              {% else %}
                <div class="alert alert-danger py-2 mb-2">
                  ‚ùå {{ choice.html|safe }} (hib√°s v√°laszt√°s)
                </div>
              {% endif %}
            {% elif choice.is_correct %}
              <div class="alert alert-info py-2 mb-2">
                üí° {{ choice.html|safe }} (helyes v√°lasz, amit nem jel√∂lt√©l)
              </div>
            {% endif %}
          {% endfor %}
        {% endif %}
      </div>

      <!-- Eredm√©ny -->
      {% if attempted_question.is_correct %}
        <div class="alert alert-success text-center fs-5">
          ‚úÖ Helyes v√°lasz! +{{ attempted_question.marks_obtained }} pont
        </div>
      {% else %}
        <div class="alert alert-danger text-center fs-5">
          ‚ùå Helytelen v√°lasz ‚Äî pontsz√°mod: {{ attempted_question.marks_obtained }}
        </div>
      {% endif %}

      <!-- K√∂vetkez≈ë k√©rd√©s gomb -->
      <div class="text-center mt-4">
        {% if quiz %}
          <a href="{% url 'quiz:play' quiz.id %}" class="btn btn-info">Kv√≠z folytat√°sa</a>
        {% endif %}
      </div>

    </div>
  </div>
</div>

{% endblock content %}
