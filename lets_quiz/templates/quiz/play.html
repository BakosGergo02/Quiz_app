{% extends 'base.html' %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
{% block content %}

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      {% if quiz.time_limit_seconds > 0 %}
      <div id="timer-box" class="timer-box mb-4 text-center">
        <span class="timer-label">H√°tral√©v≈ë id≈ë:</span>
        <span
          id="timer-display"
          class="timer-display"
          data-timeleft="{{ remaining_time }}"
          data-endurl="{% url 'quiz:quiz_end' quiz.id %}">
          {{ remaining_time }}
        </span>
      </div>

      <script src="{% static 'js/quiz_timer.js' %}"></script>
      {% endif %}

      {% if question %}
        <div class="card shadow-sm quiz-card">
          <div class="card-body">

            <h2 class="h4 mb-4 text-center">K√©rd√©s</h2>

            <form method="POST" class="quiz-form">
              {% csrf_token %}
              <input type="hidden" name="question_pk" value="{{ question.pk }}">

              <div class="question-text mb-4">
                {{ question.html|safe }}
              </div>

              {# --- P√ÅROS√çT√ì K√âRD√âS --- #}
              {% if question.matching_pairs.all %}
                <p class="text-center mb-3">
                  <strong>H√∫zd r√° a jobb oldali elemeket a megfelel≈ë bal oldali p√°rjukra!</strong>
                </p>

                <div class="row">
                  <!-- BAL OSZLOP: fix sz√∂vegek, ide h√∫zunk -->
                  <div class="col-md-6 mb-3">
                    {% for p in question.matching_pairs.all %}
                      <div class="matching-drop mb-3"
                           data-left-id="{{ p.id }}">
                        <div class="matching-left-text">
                          {{ p.left_text }}
                        </div>
                        <div class="matching-hint">
                          Ide h√∫zd a p√°rj√°t ‚Üí
                        </div>

                        <!-- ide ker√ºl vizu√°lisan a jobboldali elem -->
                        <div class="matching-slot mt-2"></div>

                        <!-- hidden input a szervernek -->
                        <input type="hidden" name="mapping_{{ p.id }}" id="mapping_{{ p.id }}">
                      </div>
                    {% endfor %}
                  </div>

                  <!-- JOBB OSZLOP: ezek lesznek random sorrendben √©s h√∫zhat√≥k -->
                  <div class="col-md-6 mb-3">
                    <div class="matching-right-item card-shadow"
                      draggable="true"
                      data-right-id="{{ p.id }}">
                      <div id="matching-right-container">
                        {% for p in question.matching_pairs.all %}
                          <div class="matching-right-item"
                              draggable="true"
                              data-right-id="{{ p.id }}">
                            {{ p.right_text }}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>

              {# --- T√ñBBV√ÅLASZOS (checkbox) --- #}
              {% elif question.is_multiple_choice %}
                <p class="text-center mb-3">
                  <strong>T√∂bb helyes v√°lasz is lehets√©ges!</strong>
                </p>
                <div class="checkbox-container">
                  {% for choice in question.choices.all %}
                    <label class="checkbox-label">
                      <input type="checkbox" name="choices" value="{{ choice.pk }}">
                      {{ choice.html|safe }}
                    </label>
                  {% endfor %}
                </div>

              {# --- SZ√ñVEGES V√ÅLASZ --- #}
              {% elif question.correct_text_answer %}
                <div class="form-group mt-3">
                  <label class="font-weight-semibold">√çrd be a v√°laszod:</label>
                  <input type="text"
                         name="text_answer"
                         class="form-control"
                         placeholder="V√°lasz...">
                </div>

              {# --- EGYV√ÅLASZOS (radio) --- #}
              {% else %}
                <div class="radio-input mt-2">
                  {% for choice in question.choices.all %}
                    <label class="label">
                      <input type="radio" name="choice_pk" value="{{ choice.pk }}">
                      <p class="text">{{ choice.html|safe }}</p>
                    </label>
                  {% endfor %}
                </div>
              {% endif %}

              <button type="submit" class="mt-4">
                V√°lasz elk√ºld√©se
              </button>
            </form>

          </div>
        </div>

      {% else %}
        <div class="card shadow-sm text-center my-5">
          <div class="card-body">
            <h2 class="mb-3">Nincs t√∂bb k√©rd√©s</h2>
            <p class="text-muted mb-4">Ezt a kv√≠zt m√°r v√©gigj√°tszottad.</p>

            <a href="{% url 'quiz:leaderboard' %}" class="btn btn-lg btn-warning mt-2 ml-2">
              <i class="fa fa-trophy" aria-hidden="true"></i> N√©zd meg a ranglist√°t
            </a>

            <!-- Modal trigger -->
            <button
              type="button"
              class="btn btn-lg btn-warning mt-3 ml-2"
              data-toggle="modal"
              data-target="#restartModal">
              üîÅ Kv√≠z √∫jrakezd√©se
            </button>
          </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="restartModal" tabindex="-1" role="dialog" aria-labelledby="restartModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title" id="restartModalLabel">Kv√≠z √∫jrakezd√©se</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Bez√°r√°s">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Biztosan √∫jra szeretn√©d kezdeni a kv√≠zt?<br>
                Az eddigi pontsz√°mod <strong>null√°z√≥dni fog</strong>.
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">M√©gse</button>
                <a href="{% url 'quiz:restart_quiz' quiz.id %}" class="btn btn-danger">Igen, kezdd √∫jra</a>
              </div>
            </div>
          </div>
        </div>
      {% endif %}

    </div>
  </div>
</div>

<script src="{% static 'js/quiz_matching.js' %}"></script>

{% endblock %}
